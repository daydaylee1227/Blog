## æ€»ç»“

ä¸»è¦æ€»ç»“Vue-daymusicé¡¹ç›®ç”¨åˆ°çš„çŸ¥è¯†ç‚¹



## day1-é¡µé¢éª¨æ¶çš„å¼€å‘

### å°å°æ€»ç»“ï¼š

webpacké…ç½®åˆ«å:

1. è¿›å…¥webpack.base.cong.jsæ–‡ä»¶

2. resolveä¸­aliaså±æ€§æ·»åŠ åˆ«å

   ```
   alias: {
         '@': resolve('src'),
         'common': resolve('src/common'),
         'components': resolve('src/components'),
         'base': resolve('src/base'),
         'api': resolve('src/api')
       }
   
   function resolve(dir) {
     return path.join(__dirname, '..', dir)
   } 
   ```

**vue stylus ä¸­ä½¿ç”¨@import å¼•å…¥è·¯å¾„é—®é¢˜**

```
<style  lang="stylus">     
//ä½¿ç”¨ç›¸å¯¹è·¯å¾„å¯ä»¥æ­£ç¡®å¯¼å…¥ 
@import '../assets/css/index.styl';     
//ä½¿ç”¨ @è·¯å¾„å¼•å…¥ æŠ¥é”™     
@import '@/assets/css/index.styl'; </style>
```

è§£å†³æ–¹æ¡ˆ

```
 @import '~@/assets /css/index.styl'
```

åŸç†ï¼šCSS loader ä¼šæŠŠæŠŠéæ ¹è·¯å¾„çš„urlè§£é‡Šä¸ºç›¸å¯¹è·¯å¾„ï¼Œ åŠ ~å‰ç¼€æ‰ä¼šè§£é‡Šæˆæ¨¡å—è·¯å¾„ã€‚

**ç»„ä»¶æ³¨å†Œä½¿ç”¨**

éœ€è¦æ³¨æ„çš„å°±æ˜¯ç»„ä»¶çš„é©¼å³°å‘½åï¼ŒMHeader â€“>> m-header

```
ç¬¬ä¸€æ­¥
import MHeader from 'components/m-header/m-header'
ç¬¬äºŒæ­¥
export default {
  components: {
    MHeader,
    Tab
  }
}
ç¬¬ä¸‰æ­¥
<m-header></m-header>
```

**router-link** å£°æ˜å¼

tagå±æ€§è¡¨ç¤ºæ¸²æŸ“æˆä»€ä¹ˆæ ‡ç­¾ï¼Œé»˜è®¤æ˜¯aæ ‡ç­¾

toè¡¨ç¤ºç›®æ ‡è·¯ç”±è¿æ¥

active-class é»˜è®¤å€¼: `"router-link-active"` æ¿€æ´»åä½¿ç”¨çš„classç±»å

**router-view**

æ¸²æŸ“è·¯å¾„åŒ¹é…åˆ°çš„è§†å›¾ç»„ä»¶

**router.push(...) ç¼–ç¨‹å¼å¯¼èˆª**

**è·¯ç”±**

é»˜è®¤çš„æ˜¯hashæ¨¡å¼ï¼Œä½¿ç”¨ URL çš„ hash æ¥æ¨¡æ‹Ÿä¸€ä¸ªå®Œæ•´çš„ URLï¼Œäºæ˜¯å½“ URL æ”¹å˜æ—¶ï¼Œé¡µé¢ä¸ä¼šé‡æ–°åŠ è½½ã€‚

å¦‚æœä¸æƒ³è¦å¾ˆä¸‘çš„ hashï¼Œæˆ‘ä»¬å¯ä»¥ç”¨è·¯ç”±çš„ **history æ¨¡å¼**ï¼Œè¿™ç§æ¨¡å¼å……åˆ†åˆ©ç”¨ `history.pushState` API æ¥å®Œæˆ URL è·³è½¬è€Œæ— é¡»é‡æ–°åŠ è½½é¡µé¢ã€‚

```
import Vue from 'vue'
import Router from 'vue-router'
Vue.use(Router)  //Vueæ³¨å†ŒRouter
```

**è·¯ç”±ä½¿ç”¨**

```
import Recommend from '@/components/recommend/recommend'
import Rank from '@/components/rank/rank'
export default new Router({
  routes: [
    {
      path: '/',
      redirect: '/recommend'
    },
    {
      path: '/',
      name: 'Recommend',
      component: Recommend
    },
  ]
})
```

--------





## day2-æ¨èé¡µé¢å¼€å‘

**å…ˆä¸‹è½½jsonpåŒ…**

```
cnpm install jsonp -S
```

**ä½¿ç”¨Promise()å°è£…JSONP**

```
// å°è£…jsonp
import originJsonp from 'jsonp'
export default function JSONP(url, data, option) {
    url += (url.indexOf('?') === -1 ? '&' : '?') + param(data)
    return new Promise((resolve, reject) => {
        originJsonp(url, option,(err, data) => {
            if(!err) {
                resolve(data)
            }else{
                reject(err)
            }
        })
    }) 
}


// å¯¹{}æ•°æ®ç»è¡Œå°è£…
export function param(data) {
    let url =''
    for(var k in data) {
        let value = data[k] === void 0 ? '' : data[k]
        url += '&'+ k + '=' + encodeURIComponent(value)
    }
    return url ? url.substring(1) : ''
}
```



**ç»™elementå…ƒç´ å¢åŠ æŸä¸ªclass**

```
// dom.js
// åˆ¤æ–­æŸä¸ªelæ˜¯å¦å…·æœ‰className
export function hasClass(el, className){
    let reg = new RegExp('(^\\s)'+ className + '(\\s|$)')
    return reg.test(el.className)
}

export function addClass(el, className){
    if(hasClass(el,className))  return 
    let newClass = el.className.split(' ')
    newClass.push(className)
    el.className = newClass.join(' ')
}

```

**propså±æ€§**

```
props: {
      loop: {
        type: Boolean,
        default: true
      },
      autoPlay: {
        type: Boolean,
        default: true
      },
      interval: {
        type: Number,
        default: 4000
      }
    }
```

**æ ‡ç­¾ä¸Šçš„refå±æ€§**

æ–¹ä¾¿è·å–åˆ°æŸä¸ªå…ƒç´ çš„DOM

```
<div ref = 'slider'></div>
var vue = new Vue({
	// this.$refs.slider --> div DOMå…ƒç´ 
})
```

### è½®æ’­å›¾å€Ÿç”¨ç¬¬ä¸‰æ–¹æ’ä»¶better-scroll

```
npm install better-scroll -S
```

ä½¿ç”¨æ–¹æ³•ğŸ‘‡

```vue
<template>
  <div class="slider" ref="slider">
    <div class="slider-group" ref="sliderGroup">
      <slot></slot>
    </div>
    <div class="dots"></div>
  </div>
</template>

// å®ç°æ— é™è½®æ’­çš„æ»šåŠ¨,ä»¥åŠå®Œæˆæ— çº¿è½®æ’­çš„æ•ˆæœ
this.slider = new BScroll(this.$refs.slider, {
        scrollX: true,
        scrollY: false,
        momentum: false,
        snap: true,
        snapLoop: this.loop, // è¡¨ç¤ºè½®æ’­
        snapThreshold: 0.3,
        snapSpeed: 400,
});
```

ä¸ºä»€ä¹ˆè½®æ’­å›¾å®ç°ä¸äº†æ— ç¼è½®æ’­ï¼Œ

è§£å†³çš„åŠæ³•å°±æ˜¯å‡ä½ç‰ˆæœ¬ï¼Œæœ€æ–°ç‰ˆæœ¬ä¸çŸ¥é“ä¸ºä»€ä¹ˆä½¿ç”¨ä¸äº†

```
"better-scroll": "^0.1.15"
```



### keep-aliveç»„ä»¶

è¯¥ç»„ä»¶çš„å¥½å¤„å°±åœ¨äºï¼Œç¼“å­˜ç»„ä»¶çš„æ•°æ®ï¼Œå°†æ•°æ®ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œæ•ˆæœæ›´åŠ ã€‚

ä¸åŠ keep-aliveç»„ä»¶çš„è¯ï¼Œæ¯æ¬¡é‡æ–°åŠ è½½çš„è¯ï¼Œä¼šé‡æ–°å»å‘èµ·æ•°æ®è¯·æ±‚ï¼Œé‚£ä¹ˆå¯¹åº”çš„æ¯”å¦‚reCommend.vueç»„ä»¶ä¼šå»é‡æ–°çš„æ¸²æŸ“ï¼Œmountedä¹Ÿä¼šé‡æ–°å»æ¸²æŸ“ï¼Œåœ¨è€…çš„è¯ï¼Œæ¯”å¦‚sliderä¹Ÿä¼šé‡æ–°å»åˆå§‹åŒ–ã€‚

è¿™æ ·å­çš„å¥½å¤„åœ¨äºå°†å®ƒä»¬çš„DOMç¼“å­˜åœ¨å†…å­˜ä¸­



**ä¸­é—´ä»¶Express**

åœ¨æœ€æ–°çš„webpacké…ç½®ä¸­ï¼Œæ‰¾åˆ°webpack.dev.conf.jsæ–‡ä»¶

æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹webpackå®˜æ–¹æ–‡æ¡£ä¸‹**[ç‚¹è¿™é‡Œ](https://webpack.js.org/configuration/dev-server/#devserverbefore)**

**devServer.before**

function (app, server, compiler)

æä¾›åœ¨æœåŠ¡å™¨å†…éƒ¨åœ¨æ‰€æœ‰å…¶ä»–ä¸­é—´ä»¶ä¹‹å‰æ‰§è¡Œè‡ªå®šä¹‰ä¸­é—´ä»¶çš„åŠŸèƒ½ã€‚è¿™å¯ä»¥ç”¨äºå®šä¹‰è‡ªå®šä¹‰å¤„ç†ç¨‹åºï¼Œä¾‹å¦‚ï¼š

**webpack.config.js**

```javascript
module.exports = {
  //...
  devServer: {
    before: function(app, server, compiler) {
      app.get('/some/path', function(req, res) {
        res.json({ custom: 'response' });
      });
    }
  }
};
```

æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ ¹æ®è¿™ä¸ªéœ€æ±‚ï¼Œå®Œæˆæˆ‘ä»¬çš„ä¸­é—´ä»¶ã€‚



### scrollç»„ä»¶

äº†è§£better-scrollä»€ä¹ˆæ—¶å€™éœ€è¦å»é‡æ–°è®¡ç®—ï¼Œæ¯”å¦‚å±å¹•çš„å®½åº¦ï¼Œè§†å£å¤§å°å‘ç”Ÿæ”¹å˜çš„è¯ï¼Œéœ€è¦refreshé‡æ–°è®¡ç®—ã€‚æ¯”å¦‚better-scrollä¸èƒ½æ»šåŠ¨çš„åŸå› æ˜¯ä»€ä¹ˆï¼Ÿ

- æ¯”å¦‚scrollç»„ä»¶ä¸‹æœ‰ä¸ªsliderç»„ä»¶ï¼Œè¿™ä¸ªç»„ä»¶ä¹Ÿæ˜¯åŸºäºbetter-scrollç»„ä»¶å®Œæˆçš„
- sliderç»„ä»¶æ¸²æŸ“æ˜¯æ ¹æ®æ•°æ®æ¥çš„ï¼Œæ‰€ä»¥sliderç»„ä»¶ä»€ä¹ˆæ—¶å€™æ¸²æŸ“å®Œæˆæ˜¯ä¸ç¡®å®šçš„
- å¯¼è‡´çš„åŸå› å°±æ˜¯scrollç»„ä»¶è®¡ç®—é«˜åº¦å‡†ç¡®ï¼Œé‡‡å–çš„åŠæ³•å°±æ˜¯ç›‘å¬äº‹ä»¶
- ç›‘å¬sliderç»„ä»¶ä¸­çš„å›¾ç‰‡åŠ è½½äº‹ä»¶ loadï¼Œ å›¾ç‰‡åŠ è½½å®Œæˆçš„è¯ï¼Œé‡æ–°å»è®¡ç®—scrollç»„ä»¶ï¼Œå³å»refresh



### vue-lazyloadå›¾ç‰‡æ‡’åŠ è½½

[ç‚¹è¿™é‡Œ](https://github.com/hilongjw/vue-lazyload)

```
$ npm i vue-lazyload -S
```

ç„¶åå°±æ˜¯æ³¨å†Œåˆ°vueä¸­

```
import Vue from 'vue'
import App from './App.vue'
import VueLazyload from 'vue-lazyload'
Vue.use(VueLazyload)
// or with options
Vue.use(VueLazyload,{
  loading : require('base/loading/loading.gif')
})
//å¯¼å…¥loadingå›¾ç‰‡
```

æœ€åé€šè¿‡ğŸ‘‡

```
<img width="60" height="60" v-lazy="item.imgurl">
```



### better-scrollä¸fastclickç‚¹å‡»äº‹ä»¶å†²çª

```
<img class="needsclick"  :src="item.picUrl" @load="loadImage">
```

ç»™ä½ éœ€è¦ç‚¹å‡»äº‹ä»¶çš„å…ƒç´ è®¾ç½®ä¸€ä¸ªclasså±æ€§ï¼Œneedsclickï¼Œè¿™æ ·å­å°±ä¸ä¼šé˜»æ­¢ç‚¹å‡»äº‹ä»¶äº†





## day3-æ­Œæ‰‹é¡µé¢å¼€å‘









## ä¼˜åŒ–

### ä½¿ç”¨keep-aliveç»„ä»¶ç¼“å­˜,èµ·åˆ°ä¸€å®šä¼˜åŒ–ã€‚



```
<keep-alive>  
      <!-- ç¼“å­˜ç»„ä»¶,å¥½å¤„åœ¨äºé¿å…äº†ç»„ä»¶çš„é‡æ–°çš„æ¸²æŸ“ -->
    <router-view></router-view>
</keep-alive>
```

### destroyed()ç”Ÿå‘½é’©å­å‡½æ•°æ¸…ç†å®šæ—¶å™¨

é‡‡ç”¨çš„æ˜¯better-scrollç¬¬ä¸‰æ–¹åº“ï¼Œæœ€ååœ¨è¯¥é’©å­å‡½æ•°çš„æ—¶å€™ï¼Œå¯ä»¥å»destroyed()

```
destroyed() {
      clearTimeout(this.timer)
    },
```



### å›¾ç‰‡æ‡’åŠ è½½

å¯¹äºéé¦–å±çš„å›¾ç‰‡ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨å›¾ç‰‡æ‡’åŠ è½½çš„æŠ€æœ¯ï¼Œä»è€Œå®ç°äº†å‡å°‘è¯·æ±‚æ•°é‡ã€‚

```
npm i vue-lazyload -S
```

